name: Publish

on:
  release:
    types: [published]

jobs:
    publish:
        runs-on: windows-latest
        steps:
            - uses: actions/checkout@v4

            -   name: Download artifacts
                uses: actions/download-artifact@v4
                with:
                    name: lib
                    path: package/lib

            -   uses: NuGet/setup-nuget@v1.2.0
                with:
                    nuget-version: 'latest'
                    
            -   name: Pack nuget
                run: nuget pack package -OutputFileNamesWithoutVersion -OutputDirectory build -Properties "git=https://github.com/${{ github.repository }}.git;name=${{ github.event.repository.name }};author=${{ github.repository_owner }};description="Gang Beasts IL2CPP proxy assemblies generated by MelonLoader for use in developing mods.";version=${{ github.event.release.tag_name }}"

            -   name: Publish nuget
                run: |
                    nuget push "build/${{ github.event.repository.name }}.nupkg" -ApiKey ${{ secrets.NUGET_KEY }} -Source https://api.nuget.org/v3/index.json